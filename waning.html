<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì˜ë£Œì¢…ì‚¬ì í™ì—­ ë©´ì—­ ì „ì´ ì‹œë®¬ë ˆì´í„°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Chart Container Styling */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 900px;
            margin-left: auto;
            margin-right: auto;
            height: 50vh;
            max-height: 500px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 500px;
            }
        }
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
    <!-- Chosen Palette: Clinical Blue & Slate.
         Primary: Blue-700 (Highlights)
         Immunity Colors: Rose-500 (Neg), Amber-500 (Part), Blue-500 (Full)
    -->

    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
</head>
<body class="bg-slate-50 text-slate-800 font-sans leading-relaxed">

    <!-- Navigation / Header -->
    <nav class="bg-white border-b border-slate-200 sticky top-0 z-50 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <div class="flex items-center gap-2">
                    <span class="text-2xl">ğŸ¥</span>
                    <h1 class="text-xl font-bold text-slate-900 tracking-tight">HCW Measles Immunity Simulator</h1>
                </div>
                <div class="flex space-x-6 text-sm font-medium">
                    <button onclick="scrollToSection('context')" class="text-slate-500 hover:text-blue-700 transition-colors">ì´ë¡ ì  ë°°ê²½</button>
                    <button onclick="scrollToSection('waning')" class="text-slate-500 hover:text-blue-700 transition-colors">ì‹œë®¬ë ˆì´í„°</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10 space-y-16">

        <!-- Section 1: Context -->
        <section id="context" class="animate-fade-in-up">
            <div class="bg-white rounded-2xl p-8 shadow-sm border border-slate-100">
                <div class="max-w-3xl mx-auto text-center space-y-4">
                    <h2 class="text-3xl font-bold text-slate-900">ê°œë³„ ë©´ì—­ ìƒíƒœì˜ ë…ë¦½ì  ì¶”ì´</h2>
                    <p class="text-lg text-slate-600">
                        ëˆ„ì  ê·¸ë˜í”„ê°€ ì•„ë‹Œ ê°œë³„ ë¼ì¸ ê·¸ë˜í”„ë¥¼ í†µí•´ ê° ì—°ë ¹ëŒ€ë³„ ë©´ì—­ ìƒíƒœì˜ ì ˆëŒ€ì ì¸ ë¹„ì¤‘ ë³€í™”ë¥¼ í™•ì¸í•©ë‹ˆë‹¤. 
                        ë°±ì‹  ì ‘ì¢…(5ì„¸) ì´í›„ ë©´ì—­ë ¥ì´ ì–´ë–»ê²Œ ë¶„ì‚°ë˜ëŠ”ì§€ ì •ë°€í•˜ê²Œ ë¶„ì„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    </p>
                </div>
                
                <div class="grid md:grid-cols-3 gap-6 mt-10 text-center">
                    <div class="bg-rose-50 p-6 rounded-xl border border-rose-100">
                        <div class="text-3xl mb-3">ğŸ“‰</div>
                        <h3 class="font-bold text-rose-900 mb-2">Seronegative (ìŒì„±)</h3>
                        <p class="text-xs text-rose-800 leading-tight">
                            ë©´ì—­ì´ ì™„ì „íˆ ì†Œì‹¤ëœ ì¸êµ¬ì˜ ë¹„ìœ¨ì…ë‹ˆë‹¤. ê·¸ë˜í”„ì—ì„œ ì ì§„ì ìœ¼ë¡œ ìƒìŠ¹í•˜ëŠ” ê³¡ì„ ì„ ê·¸ë¦½ë‹ˆë‹¤.
                        </p>
                    </div>
                    <div class="bg-amber-50 p-6 rounded-xl border border-amber-100">
                        <div class="text-3xl mb-3">âš ï¸</div>
                        <h3 class="font-bold text-amber-900 mb-2">Partial Immunity (ë¶€ë¶„)</h3>
                        <p class="text-xs text-amber-800 leading-tight">
                            ì™„ì „ ë©´ì—­ì—ì„œ ìŒì„±ìœ¼ë¡œ ë„˜ì–´ê°€ëŠ” ì¤‘ê°„ ë‹¨ê³„ì…ë‹ˆë‹¤. íŠ¹ì • ì—°ë ¹ëŒ€ì—ì„œ ì •ì ì„ ì°ê³  ë‹¤ì‹œ í•˜ê°•í•˜ëŠ” ì¢… ëª¨ì–‘ì˜ ê³¡ì„ ì„ ë³´ì…ë‹ˆë‹¤.
                        </p>
                    </div>
                    <div class="bg-blue-50 p-6 rounded-xl border border-blue-100">
                        <div class="text-3xl mb-3">ğŸ›¡ï¸</div>
                        <h3 class="font-bold text-blue-900 mb-2">Full Immunity (ì™„ì „)</h3>
                        <p class="text-xs text-blue-800 leading-tight">
                            ë°±ì‹  íš¨ê³¼ê°€ ì˜¨ì „íˆ ìœ ì§€ë˜ëŠ” ì¸êµ¬ì˜ ë¹„ìœ¨ì…ë‹ˆë‹¤. 5ì„¸ ì´í›„ ì§€ì†ì ìœ¼ë¡œ í•˜ê°•í•˜ëŠ” ê³¡ì„ ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 2: Waning Simulator -->
        <section id="waning" class="bg-slate-900 text-white rounded-3xl p-8 lg:p-12 shadow-xl">
            <div class="grid lg:grid-cols-3 gap-12 items-start">
                
                <!-- Controls Side -->
                <div class="lg:col-span-1 space-y-8">
                    <div>
                        <h2 class="text-2xl font-bold text-white mb-4 italic text-blue-400">Immunity Evolution</h2>
                        <p class="text-slate-300 text-sm leading-relaxed">
                            **5ì„¸**ë¶€í„° **100ì„¸**ê¹Œì§€ì˜ ë©´ì—­ ë°ì´í„°ë¥¼ ì‹œê°í™”í•©ë‹ˆë‹¤. <br>
                            ê°œë³„ ê³¡ì„ ì€ í•´ë‹¹ ì—°ë ¹ì—ì„œ ê° ìƒíƒœê°€ ì°¨ì§€í•˜ëŠ” **ìˆœìˆ˜ ë¹„ìœ¨**ì„ ì˜ë¯¸í•˜ë©°, ì„¸ ê³¡ì„ ì˜ í•©ì€ í•­ìƒ 100%ê°€ ë©ë‹ˆë‹¤.
                        </p>
                    </div>

                    <div class="bg-slate-800 p-6 rounded-2xl border border-slate-700 shadow-inner">
                        <label for="mu1Slider" class="block text-sm font-medium text-blue-300 mb-4">
                            ì™„ì „ ë©´ì—­ ì§€ì† ê¸°ê°„ ($\mu_1$): <span id="mu1Value" class="text-white font-bold text-xl">12</span>ë…„
                        </label>
                        <input type="range" id="mu1Slider" min="1" max="23" value="12" step="1" 
                               class="w-full h-2 bg-slate-600 rounded-lg appearance-none cursor-pointer accent-blue-500 hover:accent-blue-400">
                        <div class="flex justify-between text-[10px] text-slate-500 mt-2 uppercase tracking-tighter">
                            <span>ë¹ ë¥¸ ì†Œì‹¤ (1ë…„)</span>
                            <span>ëŠë¦° ì†Œì‹¤ (23ë…„)</span>
                        </div>
                        
                        <div class="mt-6 pt-6 border-t border-slate-700 space-y-4">
                            <div class="flex justify-between items-center text-sm">
                                <span class="text-slate-400">ë¶€ë¶„ ë©´ì—­ ì§€ì† ê¸°ê°„ ($\mu_2$):</span>
                                <span id="mu2Value" class="text-emerald-400 font-bold">12ë…„</span>
                            </div>
                            <div class="bg-slate-900/50 p-3 rounded-lg">
                                <p class="text-[10px] text-slate-500 text-center italic">
                                    $\mu_1 + \mu_2 = 24$ (Fixed Constraint)
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="p-4 bg-indigo-900/20 border border-indigo-800/50 rounded-xl">
                        <h4 class="text-xs font-bold text-indigo-400 mb-2 uppercase tracking-widest">Model ODEs</h4>
                        <div class="text-[10px] font-mono text-slate-400 space-y-1">
                            <p>dG_Full/da = - (1/Î¼1) * G_Full</p>
                            <p>dG_Part/da = (1/Î¼1) * G_Full - (1/Î¼2) * G_Part</p>
                            <p>dG_Neg/da = (1/Î¼2) * G_Part</p>
                        </div>
                    </div>
                </div>

                <!-- Chart Side -->
                <div class="lg:col-span-2 bg-white rounded-2xl p-6 text-slate-900 shadow-2xl">
                    <div class="flex flex-col sm:flex-row justify-between items-center mb-6 gap-4">
                        <h3 class="text-sm font-bold text-slate-500 uppercase tracking-widest italic">Individual Trend Analysis (Non-Stacked)</h3>
                        <div class="flex gap-4">
                            <span class="flex items-center text-[10px] font-bold text-rose-500"><span class="w-3 h-1 bg-rose-500 rounded-full mr-1"></span> Neg</span>
                            <span class="flex items-center text-[10px] font-bold text-amber-500"><span class="w-3 h-1 bg-amber-500 rounded-full mr-1"></span> Part</span>
                            <span class="flex items-center text-[10px] font-bold text-blue-500"><span class="w-3 h-1 bg-blue-500 rounded-full mr-1"></span> Full</span>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="waningChart"></canvas>
                    </div>
                    <div class="mt-6 p-4 bg-slate-50 rounded-xl border border-slate-100">
                        <p class="text-xs text-slate-500 text-center leading-relaxed">
                            ê°œë³„ ë¼ì¸ ê·¸ë˜í”„ì—ì„œëŠ” **ë¶€ë¶„ ë©´ì—­(ë…¸ë€ìƒ‰)** ê³¡ì„ ì˜ í”¼í¬ ì‹œì ì´ $\mu_1$ê³¼ $\mu_2$ì˜ ë¹„ìœ¨ì— ë”°ë¼ ì–´ë–»ê²Œ ì´ë™í•˜ëŠ”ì§€ ëª…í™•íˆ ê´€ì°°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
                            ë˜í•œ, **ìŒì„±(ë¹¨ê°„ìƒ‰)** ë¹„ìœ¨ì´ ì–´ëŠ ì—°ë ¹ëŒ€ì—ì„œ **ì™„ì „ ë©´ì—­(íŒŒë€ìƒ‰)** ë¹„ìœ¨ì„ ì¶”ì›”í•˜ëŠ”ì§€ ì‰½ê²Œ íŒŒì•…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="border-t border-slate-200 pt-8 pb-12 text-center">
            <p class="text-slate-400 text-xs">
                ë³¸ ë°ì´í„°ëŠ” ìƒë¯¸ë¶„ ë°©ì •ì‹(ODE) ìˆ˜ì¹˜ í•´ë²•ì„ í†µí•´ ê³„ì‚°ëœ ê²°ê³¼ì…ë‹ˆë‹¤.<br>
                Based on South Korean HCW Measles Immunity Research (S1 Appendix).
            </p>
        </footer>

    </main>

    <!-- Simulation Logic -->
    <script>
        // --- Global State ---
        let waningChartInstance = null;
        const TOTAL_WANING_YEARS = 24;

        // --- Data Generation (Age 5 to 100) ---
        function generateData(mu1) {
            const mu2 = TOTAL_WANING_YEARS - mu1;
            const ages = [];
            const full = [];
            const part = [];
            const neg = [];

            const l1 = 1 / mu1;
            const l2 = 1 / mu2;

            let currentFull = 100;
            let currentPart = 0;
            let currentNeg = 0;

            for (let age = 5; age <= 100; age++) {
                ages.push(age + "ì„¸");
                
                full.push(parseFloat(currentFull.toFixed(2)));
                part.push(parseFloat(currentPart.toFixed(2)));
                neg.push(parseFloat(currentNeg.toFixed(2)));

                // Euler Method for ODE Transition
                let dFull = -l1 * currentFull;
                let dPart = (l1 * currentFull) - (l2 * currentPart);
                let dNeg = l2 * currentPart;

                currentFull += dFull;
                currentPart += dPart;
                currentNeg += dNeg;

                // Clamp to prevent floating point errors
                if (currentFull < 0) currentFull = 0;
                if (currentPart < 0) currentPart = 0;
                if (currentNeg > 100) currentNeg = 100;
            }

            return { ages, full, part, neg };
        }

        // --- Chart Initialization ---
        function initChart() {
            const ctx = document.getElementById('waningChart').getContext('2d');
            const initialMu1 = 12;
            const data = generateData(initialMu1);

            waningChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.ages,
                    datasets: [
                        {
                            label: 'Seronegative (ìŒì„±)',
                            data: data.neg,
                            borderColor: '#f43f5e', // Rose-500
                            backgroundColor: 'rgba(244, 63, 94, 0.05)',
                            fill: false,
                            tension: 0.3,
                            pointRadius: 0,
                            borderWidth: 3
                        },
                        {
                            label: 'Partial Immunity (ë¶€ë¶„)',
                            data: data.part,
                            borderColor: '#f59e0b', // Amber-500
                            backgroundColor: 'rgba(245, 158, 11, 0.05)',
                            fill: false,
                            tension: 0.3,
                            pointRadius: 0,
                            borderWidth: 3
                        },
                        {
                            label: 'Full Immunity (ì™„ì „)',
                            data: data.full,
                            borderColor: '#3b82f6', // Blue-500
                            backgroundColor: 'rgba(59, 130, 246, 0.05)',
                            fill: false,
                            tension: 0.3,
                            pointRadius: 0,
                            borderWidth: 3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            padding: 12,
                            titleFont: { size: 14, weight: 'bold' },
                            bodyFont: { size: 13 },
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.parsed.y + '%';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            stacked: false, // ëˆ„ì  ê·¸ë˜í”„ í•´ì œ
                            beginAtZero: true,
                            max: 100,
                            title: { display: true, text: 'ë©´ì—­ ë¹„ì¤‘ (%)', font: { size: 11, weight: 'bold' } },
                            ticks: { 
                                font: { size: 10 },
                                callback: function(value) { return value + '%'; }
                            }
                        },
                        x: {
                            grid: { display: false },
                            title: { display: true, text: 'ì—°ë ¹ (Age)', font: { size: 11, weight: 'bold' } },
                            ticks: { 
                                font: { size: 10 },
                                autoSkip: true,
                                maxTicksLimit: 20
                            }
                        }
                    }
                }
            });
        }

        // --- Update Logic ---
        function updateSimulation(val) {
            const mu1 = parseInt(val);
            const mu2 = TOTAL_WANING_YEARS - mu1;

            document.getElementById('mu1Value').innerText = mu1;
            document.getElementById('mu2Value').innerText = mu2 + "ë…„";

            const newData = generateData(mu1);
            waningChartInstance.data.datasets[0].data = newData.neg;
            waningChartInstance.data.datasets[1].data = newData.part;
            waningChartInstance.data.datasets[2].data = newData.full;
            
            waningChartInstance.update('none');
        }

        function scrollToSection(id) {
            const el = document.getElementById(id);
            if(el) el.scrollIntoView({ behavior: 'smooth' });
        }

        document.addEventListener('DOMContentLoaded', () => {
            initChart();
            const slider = document.getElementById('mu1Slider');
            slider.addEventListener('input', (e) => updateSimulation(e.target.value));
        });
    </script>
</body>
</html>