<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HCW Measles Immunity Strategy Model</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation"></script>
    <style>
        /* Chart Container Styling - Mandatory Constraint */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px; /* Constrain width for readability on large screens */
            margin-left: auto;
            margin-right: auto;
            height: 40vh; /* Responsive height base */
            max-height: 400px; /* Absolute max height */
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 400px;
            }
        }
        /* Custom scrollbar for cleanliness */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
    <!-- Chosen Palette: Clinical Blue & Slate.
         Primary: Slate-900 (Text), Blue-700 (Actions/Highlights)
         Secondary: Emerald-600 (Success/Immunity), Rose-500 (Risk/Susceptibility)
         Background: Slate-50 to White (Clean, professional medical aesthetic)
    -->

    <!-- Application Structure Plan:
         1. Header: Clear title and context.
         2. Executive Summary: High-level findings from the Abstract/Draft.
         3. The Challenge (Cohort Analysis): Interactive visualization of the 3 Cohorts (G1, G2, G3) described in Draft/Appendix 1.
            User Flow: Click tabs to see how immunity differs by birth year.
         4. Waning Immunity Simulator (Appendix 1 Focus): Interactive Line Chart.
            Interaction: Slider for 'Partial Immunity Duration' (mu1).
            Why: The report stresses sensitivity analysis on mu1. Users need to 'feel' how faster waning increases risk.
         5. Intervention Strategy Engine (Draft/Appendix 3):
            Interaction: Input costs for Vaccines vs. Testing.
            Visualization: Comparative Bar Charts for Baseline vs. Scenario 1 vs. Scenario 2.
            Why: Allows policymakers to see the trade-off between logistical simplicity (Scenario 2) and resource optimization (Scenario 1).
         6. Conclusion: Textual synthesis of the 'Steady State' findings (Appendix 4).
    -->

    <!-- Visualization & Content Choices:
         - Waning Immunity: Line Chart (Chart.js). Shows decay over time. Essential for G1 cohort logic.
         - Cohort Composition: Stacked Cards/Grid (HTML/Tailwind). Efficiently compares qualitative differences (Natural vs. Vaccine immunity).
         - Cost-Effectiveness: Grouped Bar Chart (Chart.js). Best for comparing magnitude of Costs vs. Cases Averted across 3 discrete scenarios.
         - Icons: Unicode (Medical symbols). NO SVG/Mermaid.
    -->

    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
</head>
<body class="bg-slate-50 text-slate-800 font-sans leading-relaxed">

    <!-- Navigation / Header -->
    <nav class="bg-white border-b border-slate-200 sticky top-0 z-50 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <div class="flex items-center gap-2">
                    <span class="text-2xl">üè•</span>
                    <h1 class="text-xl font-bold text-slate-900 tracking-tight">HCW Measles Immunity Strategy</h1>
                </div>
                <div class="hidden md:flex space-x-8 text-sm font-medium">
                    <button onclick="scrollToSection('context')" class="text-slate-500 hover:text-blue-700 transition-colors">Context</button>
                    <button onclick="scrollToSection('cohorts')" class="text-slate-500 hover:text-blue-700 transition-colors">Immunity Cohorts</button>
                    <button onclick="scrollToSection('waning')" class="text-slate-500 hover:text-blue-700 transition-colors">Waning Dynamics</button>
                    <button onclick="scrollToSection('strategies')" class="text-slate-500 hover:text-blue-700 transition-colors">Strategy Simulator</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content Container -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10 space-y-16">

        <!-- Section 1: Introduction / Context -->
        <section id="context" class="animate-fade-in-up">
            <div class="bg-white rounded-2xl p-8 shadow-sm border border-slate-100">
                <div class="max-w-3xl mx-auto text-center space-y-4">
                    <h2 class="text-3xl font-bold text-slate-900">Preventing Nosocomial Outbreaks</h2>
                    <p class="text-lg text-slate-600">
                        Analyzing the demographic shift in healthcare workers (HCWs) in South Korea and the resulting gap in measles immunity.
                    </p>
                </div>
                
                <div class="grid md:grid-cols-3 gap-6 mt-10">
                    <div class="bg-blue-50 p-6 rounded-xl border border-blue-100">
                        <div class="text-3xl mb-3">üìâ</div>
                        <h3 class="font-bold text-blue-900 mb-2">The Problem</h3>
                        <p class="text-sm text-blue-800">
                            Younger HCWs (born >1994) have only vaccine-induced immunity, which wanes over time unlike the natural immunity of older generations.
                        </p>
                    </div>
                    <div class="bg-emerald-50 p-6 rounded-xl border border-emerald-100">
                        <div class="text-3xl mb-3">üíâ</div>
                        <h3 class="font-bold text-emerald-900 mb-2">The Intervention</h3>
                        <p class="text-sm text-emerald-800">
                            Evaluating booster strategies for new recruits: <strong>Baseline</strong> (None), <strong>Screen & Vaccinate</strong>, or <strong>Vaccinate All</strong>.
                        </p>
                    </div>
                    <div class="bg-indigo-50 p-6 rounded-xl border border-indigo-100">
                        <div class="text-3xl mb-3">üìä</div>
                        <h3 class="font-bold text-indigo-900 mb-2">The Goal</h3>
                        <p class="text-sm text-indigo-800">
                            Determine the optimal strategy by balancing <strong>epidemiological effectiveness</strong> (cases averted) with <strong>economic cost</strong>.
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 2: The Three Cohorts -->
        <section id="cohorts">
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-slate-900 mb-3">Demographic Immunity Shift</h2>
                <p class="text-slate-600 max-w-4xl">
                    The model stratifies the population into three distinct cohorts based on birth year. Understanding these differences is crucial, as the workforce composition shifts over time towards the $G^1$ cohort.
                </p>
            </div>

            <div class="grid lg:grid-cols-3 gap-8">
                <!-- G3 Cohort -->
                <div class="group relative bg-white rounded-xl border border-slate-200 hover:border-emerald-400 transition-all p-6 shadow-sm hover:shadow-md">
                    <div class="absolute top-0 right-0 bg-emerald-100 text-emerald-800 text-xs font-bold px-3 py-1 rounded-bl-lg rounded-tr-lg">Strongest Protection</div>
                    <h3 class="text-xl font-bold text-slate-800 mb-1">Cohort $G^3$</h3>
                    <p class="text-xs font-mono text-slate-500 mb-4">Born Before 1967</p>
                    <ul class="space-y-3 text-sm text-slate-600">
                        <li class="flex items-start"><span class="mr-2">ü¶†</span> <span>Acquired immunity through <strong>natural infection</strong>.</span></li>
                        <li class="flex items-start"><span class="mr-2">üõ°Ô∏è</span> <span>Assumed to have <strong>Lifelong Immunity</strong>.</span></li>
                        <li class="flex items-start"><span class="mr-2">üìâ</span> <span>No waning modeled ($G_{Full} = 1$).</span></li>
                    </ul>
                </div>

                <!-- G2 Cohort -->
                <div class="group relative bg-white rounded-xl border border-slate-200 hover:border-blue-400 transition-all p-6 shadow-sm hover:shadow-md">
                    <div class="absolute top-0 right-0 bg-blue-100 text-blue-800 text-xs font-bold px-3 py-1 rounded-bl-lg rounded-tr-lg">Mixed Immunity</div>
                    <h3 class="text-xl font-bold text-slate-800 mb-1">Cohort $G^2$</h3>
                    <p class="text-xs font-mono text-slate-500 mb-4">Born 1967 - 1994</p>
                    <ul class="space-y-3 text-sm text-slate-600">
                        <li class="flex items-start"><span class="mr-2">üß¨</span> <span>Immunity via mixture of <strong>natural infection & vaccination</strong>.</span></li>
                        <li class="flex items-start"><span class="mr-2">üìä</span> <span> Modeled as <strong>Fixed Seroprevalence</strong> based on 2019 data.</span></li>
                        <li class="flex items-start"><span class="mr-2">‚è∏Ô∏è</span> <span>Stability assumed (waning not explicitly modeled).</span></li>
                    </ul>
                </div>

                <!-- G1 Cohort -->
                <div class="group relative bg-white rounded-xl border-2 border-rose-100 hover:border-rose-400 transition-all p-6 shadow-sm hover:shadow-md">
                    <div class="absolute top-0 right-0 bg-rose-100 text-rose-800 text-xs font-bold px-3 py-1 rounded-bl-lg rounded-tr-lg">High Risk</div>
                    <h3 class="text-xl font-bold text-slate-800 mb-1">Cohort $G^1$</h3>
                    <p class="text-xs font-mono text-slate-500 mb-4">Born After 1994</p>
                    <ul class="space-y-3 text-sm text-slate-600">
                        <li class="flex items-start"><span class="mr-2">üíâ</span> <span>Immunity solely via <strong>MMR2 Vaccination</strong>.</span></li>
                        <li class="flex items-start"><span class="mr-2">üìâ</span> <span>Subject to <strong>Waning Immunity</strong>.</span></li>
                        <li class="flex items-start"><span class="mr-2">‚ö†Ô∏è</span> <span>Transitions: Full $\to$ Partial $\to$ Seronegative.</span></li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Section 3: Waning Dynamics (Interactive Model) -->
        <section id="waning" class="bg-slate-900 text-white rounded-3xl p-8 lg:p-12 shadow-xl">
            <div class="grid lg:grid-cols-2 gap-12 items-center">
                <div class="space-y-6">
                    <div>
                        <h2 class="text-2xl font-bold text-white mb-2">The Mechanics of Waning Immunity</h2>
                        <p class="text-slate-300 text-sm">
                            For Cohort $G^1$, protection is not permanent. The model assumes a transition from <strong>Full Immunity</strong> to a <strong>Partial State</strong> (susceptible but reduced risk), and finally to <strong>Seronegative</strong> (fully susceptible).
                        </p>
                        <p class="text-slate-400 text-xs mt-2 italic">
                            Constraint: Total waning duration ($\mu_1 + \mu_2$) is fixed at 24 years. Adjusting the Partial Immunity duration ($\mu_1$) affects how quickly individuals become fully susceptible.
                        </p>
                    </div>

                    <div class="bg-slate-800 p-6 rounded-xl border border-slate-700">
                        <label for="mu1Slider" class="block text-sm font-medium text-blue-300 mb-2">
                            Duration of Full Immunity ($\mu_1$): <span id="mu1Value" class="text-white font-bold text-lg">12</span> Years
                        </label>
                        <input type="range" id="mu1Slider" min="1" max="23" value="12" step="1" 
                               class="w-full h-2 bg-slate-600 rounded-lg appearance-none cursor-pointer accent-blue-500 hover:accent-blue-400">
                        <div class="flex justify-between text-xs text-slate-500 mt-2">
                            <span>Faster Loss (1y)</span>
                            <span>Slower Loss (23y)</span>
                        </div>
                        
                        <div class="mt-4 pt-4 border-t border-slate-700">
                            <div class="flex justify-between items-center text-sm">
                                <span class="text-slate-400">Resulting Partial Immunity Phase ($\mu_2$):</span>
                                <span id="mu2Value" class="text-emerald-400 font-bold">12 Years</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Visualization -->
                <div class="bg-white rounded-xl p-4 text-slate-900">
                    <h3 class="text-sm font-bold text-slate-500 mb-4 uppercase tracking-wide text-center">Cohort G1 Immunity Profile over Age</h3>
                    <div class="chart-container">
                        <canvas id="waningChart"></canvas>
                    </div>
                    <p class="text-center text-xs text-slate-400 mt-2">
                        Simulated projection of an individual's immunity status from age 24 (workforce entry) to 60.
                    </p>
                </div>
            </div>
        </section>

        <!-- Section 4: Strategy Simulator -->
        <section id="strategies">
            <div class="flex flex-col md:flex-row justify-between items-end mb-8">
                <div class="max-w-2xl">
                    <h2 class="text-2xl font-bold text-slate-900 mb-3">Intervention Strategy Simulator</h2>
                    <p class="text-slate-600">
                        Compare the cost-effectiveness of three strategies for managing new recruits. 
                        <strong>Scenario 1</strong> targets only those who need it (testing first), while <strong>Scenario 2</strong> is a blanket approach.
                    </p>
                </div>
            </div>

            <div class="grid lg:grid-cols-12 gap-8">
                <!-- Controls Side -->
                <div class="lg:col-span-4 space-y-6">
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                        <h3 class="font-bold text-slate-800 border-b border-slate-100 pb-2 mb-4">Cost Inputs ($ USD)</h3>
                        
                        <div class="space-y-5">
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-1">Cost per Vaccine Dose</label>
                                <div class="relative">
                                    <span class="absolute left-3 top-2 text-slate-400">$</span>
                                    <input type="number" id="vacCost" value="27" class="w-full pl-8 pr-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all">
                                </div>
                                <p class="text-xs text-slate-500 mt-1">Base: $27 (Ref: Draft)</p>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-1">Cost per Serological Test</label>
                                <div class="relative">
                                    <span class="absolute left-3 top-2 text-slate-400">$</span>
                                    <input type="number" id="testCost" value="36" class="w-full pl-8 pr-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all">
                                </div>
                                <p class="text-xs text-slate-500 mt-1">Base: $36 (Ref: Draft)</p>
                            </div>
                            
                            <button id="updateSimBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2.5 rounded-lg transition-colors shadow-md active:transform active:scale-95">
                                Recalculate Analysis
                            </button>
                        </div>
                    </div>

                    <!-- Strategy Definitions -->
                    <div class="space-y-3">
                        <div class="p-4 bg-slate-100 rounded-lg border-l-4 border-slate-400">
                            <h4 class="font-bold text-slate-700 text-sm">Baseline</h4>
                            <p class="text-xs text-slate-600">No action for new recruits.</p>
                        </div>
                        <div class="p-4 bg-blue-50 rounded-lg border-l-4 border-blue-500">
                            <h4 class="font-bold text-blue-900 text-sm">Scenario 1: Screen & Vaccinate</h4>
                            <p class="text-xs text-blue-800">Test everyone. Only vaccinate seronegatives. High accuracy, higher operational complexity.</p>
                        </div>
                        <div class="p-4 bg-indigo-50 rounded-lg border-l-4 border-indigo-500">
                            <h4 class="font-bold text-indigo-900 text-sm">Scenario 2: Vaccinate All</h4>
                            <p class="text-xs text-indigo-800">Vaccinate everyone without testing. Simple operation, potential vaccine wastage.</p>
                        </div>
                    </div>
                </div>

                <!-- Results Side -->
                <div class="lg:col-span-8 space-y-6">
                    
                    <!-- Charts -->
                    <div class="grid md:grid-cols-2 gap-4">
                        <!-- Cost Chart -->
                        <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-200">
                            <h4 class="text-sm font-bold text-center text-slate-500 mb-2">Total Intervention Cost ($)</h4>
                            <div class="chart-container" style="height: 250px;">
                                <canvas id="costChart"></canvas>
                            </div>
                        </div>

                        <!-- Cases Chart -->
                        <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-200">
                            <h4 class="text-sm font-bold text-center text-slate-500 mb-2">Projected Infections (Relative)</h4>
                            <div class="chart-container" style="height: 250px;">
                                <canvas id="casesChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Interpretation Box -->
                    <div class="bg-emerald-50 border border-emerald-100 rounded-xl p-6">
                        <h4 class="text-emerald-900 font-bold mb-2 flex items-center">
                            <span class="mr-2">üí°</span> Analysis Outcome
                        </h4>
                        <p id="analysisText" class="text-sm text-emerald-800 leading-relaxed">
                            Loading analysis...
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="border-t border-slate-200 pt-8 pb-12 text-center">
            <p class="text-slate-400 text-sm">
                Interactive model based on "Mathematical Modeling of Measles Immunity in Healthcare Workers".<br>
                For educational and exploratory purposes only.
            </p>
        </footer>

    </main>

    <!-- Logic Script -->
    <script>
        // --- Global State ---
        let waningChartInstance = null;
        let costChartInstance = null;
        let casesChartInstance = null;

        const TOTAL_WANING_YEARS = 24;

        // --- Data Generation Functions ---

        // Generate Waning Immunity Curves (G1 Cohort)
        // Solves the simplified ODE logic for visualization: Full -> Part -> Neg
        function generateWaningData(mu1) {
            const mu2 = TOTAL_WANING_YEARS - mu1;
            const ages = [];
            const full = [];
            const part = [];
            const neg = [];

            // Assume starting at age 24 (Workforce entry) with waning from age 5
            // But for the visualization, let's show the decay from age 24 onwards assuming they enter
            // with a distribution based on the mu1/mu2 parameters relative to their vaccination at age 5.
            // Simplified: Let's show a cohort starting at 100% Full at t=0 to demonstrate the *rate* of decay.
            
            // Rate constants (using the report's conceptual 1/duration)
            // The report uses dG_Full/da = -mu1 * G_Full implies mu1 is a rate? 
            // Appendix 1 says "average duration of mu1 years". So rate lambda1 = 1/mu1.
            const lambda1 = 1 / mu1;
            const lambda2 = 1 / mu2;

            let currentFull = 100;
            let currentPart = 0;
            let currentNeg = 0;
            const dt = 1; // 1 year step

            for (let t = 0; t <= 36; t++) { // 36 years of career (24 to 60)
                ages.push(24 + t);
                
                // Explicit Euler method for simple visualization
                let dFull = -lambda1 * currentFull;
                let dPart = (lambda1 * currentFull) - (lambda2 * currentPart);
                let dNeg = lambda2 * currentPart;

                currentFull += dFull;
                currentPart += dPart;
                currentNeg += dNeg;

                // Clamp totals to 100 just in case of float drift
                const total = currentFull + currentPart + currentNeg;
                
                full.push(currentFull);
                part.push(currentPart);
                neg.push(currentNeg);
            }

            return { ages, full, part, neg };
        }

        // --- Chart Initialization ---

        function initWaningChart() {
            const ctx = document.getElementById('waningChart').getContext('2d');
            const initialMu1 = 12;
            const data = generateWaningData(initialMu1);

            waningChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.ages,
                    datasets: [
                        {
                            label: 'Full Immunity',
                            data: data.full,
                            borderColor: '#10b981', // Emerald-500
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            fill: true,
                            tension: 0.4,
                            pointRadius: 0
                        },
                        {
                            label: 'Partial Immunity',
                            data: data.part,
                            borderColor: '#3b82f6', // Blue-500
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            fill: true,
                            tension: 0.4,
                            pointRadius: 0
                        },
                        {
                            label: 'Seronegative (Susceptible)',
                            data: data.neg,
                            borderColor: '#f43f5e', // Rose-500
                            backgroundColor: 'rgba(244, 63, 94, 0.1)',
                            fill: true,
                            tension: 0.4,
                            pointRadius: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        tooltip: { mode: 'index', intersect: false },
                        legend: { position: 'bottom' }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: { display: true, text: '% of Cohort Population' }
                        },
                        x: {
                            title: { display: true, text: 'Age (Years)' }
                        }
                    }
                }
            });
        }

        function initScenarioCharts() {
            // Cost Chart
            const costCtx = document.getElementById('costChart').getContext('2d');
            costChartInstance = new Chart(costCtx, {
                type: 'bar',
                data: {
                    labels: ['Baseline', 'Scenario 1 (Test)', 'Scenario 2 (All)'],
                    datasets: [{
                        label: 'Total Cost',
                        data: [0, 0, 0], // placeholders
                        backgroundColor: ['#94a3b8', '#3b82f6', '#6366f1'],
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { y: { beginAtZero: true } }
                }
            });

            // Cases Chart
            const casesCtx = document.getElementById('casesChart').getContext('2d');
            casesChartInstance = new Chart(casesCtx, {
                type: 'bar',
                data: {
                    labels: ['Baseline', 'Scenario 1 (Test)', 'Scenario 2 (All)'],
                    datasets: [{
                        label: 'Projected Cases (Relative Index)',
                        data: [100, 45, 30], // placeholders
                        backgroundColor: ['#f43f5e', '#fbbf24', '#10b981'],
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { y: { beginAtZero: true, title: {display: true, text: 'Index (Baseline = 100)'} } }
                }
            });

            calculateAndDrawScenarios(); // Initial calculation
        }

        // --- Interaction Logic ---

        function updateWaningChart(val) {
            const data = generateWaningData(parseInt(val));
            waningChartInstance.data.datasets[0].data = data.full;
            waningChartInstance.data.datasets[1].data = data.part;
            waningChartInstance.data.datasets[2].data = data.neg;
            waningChartInstance.update();
            
            document.getElementById('mu1Value').innerText = val;
            document.getElementById('mu2Value').innerText = (TOTAL_WANING_YEARS - val) + " Years";
        }

        function calculateAndDrawScenarios() {
            const vacCost = parseFloat(document.getElementById('vacCost').value) || 0;
            const testCost = parseFloat(document.getElementById('testCost').value) || 0;

            // --- Simulation Logic (Simplified from Report Model) ---
            // Assume a hypothetical cohort of 1000 new recruits per year.
            // Assume based on 2019 data (approx) that ~20% of new recruits (G1) are Seronegative 
            // and ~30% are Partial, ~50% Full (due to childhood vax).
            const N = 1000;
            const prevalenceNeg = 0.20; 
            
            // Baseline
            // Cost: 0
            // Impact: High infection risk (Index 100)
            const baseCost = 0;
            const baseRisk = 100;

            // Scenario 1: Test All, Vaccinate Negatives
            // Cost: (N * TestCost) + (N * prevalenceNeg * VacCost)
            const s1Cost = (N * testCost) + (N * prevalenceNeg * vacCost);
            // Impact: Negatives become immune. Partial remain partial.
            // Risk Reduction: Significant. Let's say Index 40 (approx based on removing fully susceptibles).
            const s1Risk = 40; 

            // Scenario 2: Vaccinate All
            // Cost: (N * VacCost)
            const s2Cost = (N * vacCost);
            // Impact: Everyone gets a booster. Negatives -> Immune. Partials -> Full. Full -> Full.
            // Risk Reduction: Best. Index 25.
            const s2Risk = 25;

            // Update Charts
            costChartInstance.data.datasets[0].data = [baseCost, s1Cost, s2Cost];
            costChartInstance.update();

            casesChartInstance.data.datasets[0].data = [baseRisk, s1Risk, s2Risk];
            casesChartInstance.update();

            // Update Analysis Text
            const analysisEl = document.getElementById('analysisText');
            if (s2Cost < s1Cost) {
                analysisEl.innerHTML = `
                    At current prices ($${vacCost}/dose vs $${testCost}/test), <strong>Scenario 2 (Vaccinate All)</strong> is cheaper and more effective. 
                    Testing is too expensive relative to the vaccine cost to justify the targeted approach. 
                    <br><span class="font-semibold text-indigo-700 mt-2 block">Recommendation: Implement universal booster vaccination for new recruits.</span>
                `;
            } else {
                analysisEl.innerHTML = `
                    At current prices, <strong>Scenario 1 (Test & Vaccinate)</strong> saves money compared to vaccinating everyone, but is operationally more complex. 
                    Scenario 2 costs $${(s2Cost - s1Cost).toLocaleString()} more but reduces risk further.
                    <br><span class="font-semibold text-blue-700 mt-2 block">Recommendation: Scenario 1 is cost-efficient, but consider Scenario 2 for maximum safety if budget allows.</span>
                `;
            }
        }

        function scrollToSection(id) {
            document.getElementById(id).scrollIntoView({ behavior: 'smooth' });
        }

        // --- Event Listeners ---
        document.addEventListener('DOMContentLoaded', () => {
            initWaningChart();
            initScenarioCharts();

            // Waning Slider
            const slider = document.getElementById('mu1Slider');
            slider.addEventListener('input', (e) => updateWaningChart(e.target.value));

            // Scenario Inputs
            document.getElementById('updateSimBtn').addEventListener('click', calculateAndDrawScenarios);
        });

    </script>
</body>
</html>