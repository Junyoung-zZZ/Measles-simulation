<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì˜ë£Œì¢…ì‚¬ì í™ì—­ ë©´ì—­ ì „ì´ ì‹œë®¬ë ˆì´í„°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* ì°¨íŠ¸ ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ë§ */
        .chart-container {
            position: relative;
            width: 100%;
            height: 40vh;
            min-height: 300px;
            max-height: 450px;
        }
        /* ì»¤ìŠ¤í…€ ìŠ¤í¬ë¡¤ë°” */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 font-sans leading-relaxed">

    <!-- ë‚´ë¹„ê²Œì´ì…˜ / í—¤ë” -->
    <nav class="bg-white border-b border-slate-200 sticky top-0 z-50 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <div class="flex items-center gap-2">
                    <span class="text-2xl">ğŸ¥</span>
                    <h1 class="text-xl font-bold text-slate-900 tracking-tight">HCW Measles Immunity Simulator</h1>
                </div>
                <div class="hidden sm:flex space-x-6 text-sm font-medium">
                    <button onclick="scrollToSection('context')" class="text-slate-500 hover:text-blue-700 transition-colors">ì´ë¡ ì  ë°°ê²½</button>
                    <button onclick="scrollToSection('waning')" class="text-slate-500 hover:text-blue-700 transition-colors">ì‹œë®¬ë ˆì´í„°</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- ë©”ì¸ ì½˜í…ì¸  -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10 space-y-12">

        <!-- ì„¹ì…˜ 1: ì´ë¡ ì  ë°°ê²½ -->
        <section id="context" class="animate-fade-in-up">
            <div class="bg-white rounded-2xl p-8 shadow-sm border border-slate-100">
                <div class="max-w-3xl mx-auto text-center space-y-4">
                    <h2 class="text-3xl font-bold text-slate-900">ë©´ì—­ ì „ì´ ëª¨ë¸ ì‹œê°í™” ê°œì„ </h2>
                    <p class="text-lg text-slate-600">
                        ëˆ„ì  ê·¸ë˜í”„ì˜ ìƒ‰ìƒ ì¤‘ì²© ë¬¸ì œë¥¼ í•´ê²°í•˜ì—¬ ê° ë©´ì—­ ìƒíƒœì˜ ìˆœìˆ˜ ë¹„ì¤‘ì„ ë” ëª…í™•í•˜ê²Œ ë³¼ ìˆ˜ ìˆë„ë¡ ê°œì„ í–ˆìŠµë‹ˆë‹¤. 
                        ì˜ì—­ì´ ê²¹ì¹˜ì§€ ì•Šê³  ì¸µë³„ë¡œ ê¹”ë”í•˜ê²Œ ìŒ“ì—¬ ë°ì´í„°ë¥¼ ì§ê´€ì ìœ¼ë¡œ íŒŒì•…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    </p>
                </div>
                
                <div class="grid md:grid-cols-3 gap-6 mt-10 text-center">
                    <div class="bg-blue-50 p-6 rounded-xl border border-blue-100">
                        <div class="text-3xl mb-3">ğŸ›¡ï¸</div>
                        <h3 class="font-bold text-blue-900 mb-2">Full Immunity (ì™„ì „)</h3>
                        <p class="text-xs text-blue-800 leading-tight">ê°€ì¥ ê°•ë ¥í•œ ë³´í˜¸ ìƒíƒœì…ë‹ˆë‹¤.</p>
                    </div>
                    <div class="bg-amber-50 p-6 rounded-xl border border-amber-100">
                        <div class="text-3xl mb-3">âš ï¸</div>
                        <h3 class="font-bold text-amber-900 mb-2">Partial Immunity (ë¶€ë¶„)</h3>
                        <p class="text-xs text-amber-800 leading-tight">ë°©ì–´ë ¥ì´ ê°í‡´í•˜ê¸° ì‹œì‘í•œ ì¤‘ê°„ ë‹¨ê³„ì…ë‹ˆë‹¤.</p>
                    </div>
                    <div class="bg-rose-50 p-6 rounded-xl border border-rose-100">
                        <div class="text-3xl mb-3">ğŸ“‰</div>
                        <h3 class="font-bold text-rose-900 mb-2">Seronegative (ìŒì„±)</h3>
                        <p class="text-xs text-rose-800 leading-tight">ë©´ì—­ì´ ì†Œì‹¤ë˜ì–´ ê°ì—¼ì— ì·¨ì•½í•œ ìƒíƒœì…ë‹ˆë‹¤.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- ì„¹ì…˜ 2: ì¸í„°ë™í‹°ë¸Œ ëŒ€ì‹œë³´ë“œ -->
        <section id="waning" class="space-y-8">
            
            <!-- ì»¨íŠ¸ë¡¤ íŒ¨ë„ -->
            <div class="bg-slate-900 text-white rounded-3xl p-8 shadow-xl">
                <div class="max-w-2xl mx-auto text-center space-y-6">
                    <div>
                        <h2 class="text-2xl font-bold text-blue-400 italic mb-2">Simulation Parameters</h2>
                        <p class="text-slate-400 text-sm">ìŠ¬ë¼ì´ë”ë¥¼ í†µí•´ ìƒì•  ì£¼ê¸°(5~100ì„¸) ë©´ì—­ ì „ì´ ì†ë„ë¥¼ ì¡°ì ˆí•˜ì„¸ìš”.</p>
                    </div>
                    
                    <div class="bg-slate-800 p-6 rounded-2xl border border-slate-700">
                        <label for="mu1Slider" class="block text-sm font-medium text-blue-300 mb-4">
                            ì™„ì „ ë©´ì—­ ì§€ì† ê¸°ê°„ ($\mu_1$): <span id="mu1Value" class="text-white font-bold text-2xl">12</span>ë…„
                        </label>
                        <input type="range" id="mu1Slider" min="1" max="23" value="12" step="1" 
                               class="w-full h-2 bg-slate-600 rounded-lg appearance-none cursor-pointer accent-blue-500 hover:accent-blue-400">
                        <div class="flex justify-between text-[10px] text-slate-500 mt-2 uppercase tracking-tighter">
                            <span>ë¹ ë¦„ (1ë…„)</span>
                            <span>ëŠë¦¼ (23ë…„)</span>
                        </div>
                        <div class="mt-6 flex justify-between items-center text-sm border-t border-slate-700 pt-4">
                            <span class="text-slate-400">ë¶€ë¶„ ë©´ì—­ ì§€ì† ê¸°ê°„ ($\mu_2$): <span id="mu2Value" class="text-emerald-400 font-bold ml-1">12ë…„</span></span>
                            <span class="text-[10px] text-slate-500 italic">$\mu_1 + \mu_2 = 24$ (Fixed)</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ì°¨íŠ¸ ëŒ€ì‹œë³´ë“œ -->
            <div class="grid lg:grid-cols-2 gap-8">
                
                <!-- A. Individual (No Stacked) -->
                <div class="bg-white rounded-2xl p-6 shadow-lg border border-slate-100">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-sm font-bold text-slate-500 uppercase tracking-widest italic">A. Individual Trend (No Stacked)</h3>
                        <div class="flex gap-4">
                            <span class="flex items-center text-[10px] font-bold text-blue-500"><span class="w-3 h-1 bg-blue-500 rounded-full mr-1"></span> Full</span>
                            <span class="flex items-center text-[10px] font-bold text-amber-500"><span class="w-3 h-1 bg-amber-500 rounded-full mr-1"></span> Part</span>
                            <span class="flex items-center text-[10px] font-bold text-rose-500"><span class="w-3 h-1 bg-rose-500 rounded-full mr-1"></span> Neg</span>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="individualChart"></canvas>
                    </div>
                    <p class="mt-4 text-[11px] text-slate-400 text-center">ê°œë³„ ìƒíƒœì˜ ë…ë¦½ì ì¸ ë¹„ìœ¨ ë³€í™” ì¶”ì´ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.</p>
                </div>

                <!-- B. Composition (Stacked: Full -> Part -> Neg) -->
                <div class="bg-white rounded-2xl p-6 shadow-lg border border-slate-100">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-sm font-bold text-slate-500 uppercase tracking-widest italic">B. Composition (Stacked - Optimized)</h3>
                        <div class="flex gap-4 text-[10px] font-bold text-slate-400 uppercase">
                            <span>Order: Full â†’ Part â†’ Neg</span>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="stackedChart"></canvas>
                    </div>
                    <p class="mt-4 text-[11px] text-slate-400 text-center">ì „ì²´ ì¸êµ¬ ëŒ€ë¹„ ê° ìƒíƒœì˜ ëˆ„ì  ë¹„ì¤‘ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. (ìƒ‰ìƒ ê²¹ì¹¨ í•´ê²°)</p>
                </div>

            </div>
        </section>

        <!-- í‘¸í„° -->
        <footer class="border-t border-slate-200 pt-8 pb-12 text-center text-slate-400 text-xs">
            <p>Â© 2024 Measles Immunity Study Group. Based on ODE-based Simulation (Age 5 - 100).</p>
        </footer>

    </main>

    <script>
        let indChart = null;
        let stkChart = null;
        const CONSTRAINT_TOTAL = 24;

        function generateData(mu1) {
            const mu2 = CONSTRAINT_TOTAL - mu1;
            const ages = [];
            const full = [];
            const part = [];
            const neg = [];
            const l1 = 1 / mu1;
            const l2 = 1 / mu2;
            let cF = 100;
            let cP = 0;
            let cN = 0;

            for (let age = 5; age <= 100; age++) {
                ages.push(age + "ì„¸");
                full.push(parseFloat(cF.toFixed(2)));
                part.push(parseFloat(cP.toFixed(2)));
                neg.push(parseFloat(cN.toFixed(2)));
                let dF = -l1 * cF;
                let dP = (l1 * cF) - (l2 * cP);
                let dN = l2 * cP;
                cF += dF; cP += dP; cN += dN;
                if (cF < 0) cF = 0;
                if (cP < 0) cP = 0;
                if (cN > 100) cN = 100;
            }
            return { ages, full, part, neg };
        }

        function getChartConfig(data, isStacked) {
            const alphaVal = isStacked ? 0.6 : 0.05; // ëˆ„ì  ê·¸ë˜í”„ ì˜ì—­ì˜ íˆ¬ëª…ë„ ì¡°ì ˆ
            const C_FULL = `rgba(59, 130, 246, ${alphaVal})`;
            const C_PART = `rgba(245, 158, 11, ${alphaVal})`;
            const C_NEG  = `rgba(244, 63, 94, ${alphaVal})`;
            
            const B_FULL = '#3b82f6';
            const B_PART = '#f59e0b';
            const B_NEG  = '#f43f5e';

            return {
                type: 'line',
                data: {
                    labels: data.ages,
                    datasets: [
                        {
                            label: 'ì™„ì „ (Full)',
                            data: data.full,
                            borderColor: B_FULL,
                            backgroundColor: C_FULL,
                            fill: isStacked ? 'origin' : false, // í•˜ë‹¨ì€ ë°”ë‹¥ë¶€í„° ì±„ì›€
                            tension: 0.2,
                            pointRadius: 0,
                            borderWidth: 2,
                        },
                        {
                            label: 'ë¶€ë¶„ (Part)',
                            data: data.part,
                            borderColor: B_PART,
                            backgroundColor: C_PART,
                            fill: isStacked ? '-1' : false, // ì´ì „ ë°ì´í„°ì…‹(Full)ê¹Œì§€ë§Œ ì±„ì›€ (ê²¹ì¹¨ ë°©ì§€)
                            tension: 0.2,
                            pointRadius: 0,
                            borderWidth: 2,
                        },
                        {
                            label: 'ìŒì„± (Neg)',
                            data: data.neg,
                            borderColor: B_NEG,
                            backgroundColor: C_NEG,
                            fill: isStacked ? '-1' : false, // ì´ì „ ë°ì´í„°ì…‹(Part)ê¹Œì§€ë§Œ ì±„ì›€ (ê²¹ì¹¨ ë°©ì§€)
                            tension: 0.2,
                            pointRadius: 0,
                            borderWidth: 2,
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: { 
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(15, 23, 42, 0.9)',
                            padding: 10
                        }
                    },
                    scales: {
                        y: {
                            stacked: isStacked,
                            beginAtZero: true,
                            max: 100,
                            title: { display: true, text: 'ë¹„ìœ¨ (%)', font: { size: 10, weight: 'bold' } },
                            ticks: { font: { size: 9 } }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { font: { size: 9 }, autoSkip: true, maxTicksLimit: 15 }
                        }
                    }
                }
            };
        }

        function initDashboard() {
            const data = generateData(12);
            const ctxInd = document.getElementById('individualChart').getContext('2d');
            indChart = new Chart(ctxInd, getChartConfig(data, false));
            const ctxStk = document.getElementById('stackedChart').getContext('2d');
            stkChart = new Chart(ctxStk, getChartConfig(data, true));
        }

        function updateDashboard(val) {
            const mu1 = parseInt(val);
            const mu2 = CONSTRAINT_TOTAL - mu1;
            document.getElementById('mu1Value').innerText = mu1;
            document.getElementById('mu2Value').innerText = mu2 + "ë…„";
            const newData = generateData(mu1);
            [indChart, stkChart].forEach(chart => {
                chart.data.datasets[0].data = newData.full;
                chart.data.datasets[1].data = newData.part;
                chart.data.datasets[2].data = newData.neg;
                chart.update('none');
            });
        }

        function scrollToSection(id) {
            const el = document.getElementById(id);
            if(el) el.scrollIntoView({ behavior: 'smooth' });
        }

        document.addEventListener('DOMContentLoaded', () => {
            initDashboard();
            document.getElementById('mu1Slider').addEventListener('input', (e) => updateDashboard(e.target.value));
        });
    </script>
</body>
</html>
